name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€
on: [push]
jobs:
  mpi:
    runs-on: ubuntu-22.04
    strategy:
      fail-fast: false
      matrix:
        compiler: [gcc-12, clang-15]
        mpi: [openmpi, mpich]
    steps:
      - name: Checkout this repository
        uses: actions/checkout@v4
      - name: Setup MPI
        uses: ./.github/actions/setup-mpi
        with:
          compiler: ${{ matrix.compiler }}
          mpi: ${{ matrix.mpi }}
      - name: Print environments
        run: |
          echo "Compiler : ${{ matrix.compiler }}"
          echo "MPI      : ${{ matrix.mpi }}"
          echo "nproc    : $(nproc)"
          echo
          echo "$ mpicc --version"
          mpicc --version
          echo
          echo "$ mpicxx --version"
          mpicxx --version
          echo
          echo "$ mpiexec --version"
          mpiexec --version
      - name: Run MPI
        run: |
          export OMPI_MCA_prte_set_default_slots=hwthreads
          echo "$ mpiexec hostname"
          mpiexec hostname
          echo
          echo "$ mpiexec -n 2 hostname"
          mpiexec -n 2 hostname
          echo
          echo "$ mpiexec -n 4 hostname"
          mpiexec -n 4 hostname
